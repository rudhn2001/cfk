apiVersion: platform.confluent.io/v1beta1
kind: Zookeeper
metadata:
  name: zookeeper
  namespace: confluent
spec:
  replicas: 3
  image:
    application: confleuntinc/cp-zookeeper:7.6.0
    init: confluentinc/confluent-init-container:2.8.0
  dataVolumeCapacity: 10Gi
  logVolumeCapacity: 10Gi
  authentication:
    type: digest
    jaasConfig: 
      secretRef: credential
  tls:
    autogeneratedCerts: true
---
apiVersion: v1
kind: Kafka
metadata:
  name:  kafka
  namespace: confluent
spec:
  replicas: 3
  image:
    application: confluentinc/cp-server:7.6.0
    init: confluentinc/confluent-init-container:2.8.0
  dataVolumeCapacity: 10Gi
  tls:
    autogeneratedCerts: true
  listeners:
    internal:
      authentication:
        type: plain
        jaasConfig:
          secretRef: credential
      tls:
        enabled: true
    external:
      authentication:
        type: plain
        jaasConfig:
          secretRef: credential
      tls:
        enabled: true
      externalAccess:
        type: loadBalancer
        loadBalancer:
          domain: my.domain
          brokerPrefix: rb
          bootstrapPrefix: rb
        tls:
          enabled: true
    authorization:
      type: rbac
      superUsers:
      - User: kafka
    services:
      mds:
        tls:
          enabled: true
        tokenKeyPair:
          secretRef: mds-token
        externalAccess:
          type: loadBalancer
          loadBalancer:
            domain: my.domain
            prefix: rb-mds
        provider:
          type: ldap
          ldap:
            address: ldap://ldap.confluent.svc.cluster.local:389
            authentication:
              type: simple
              simple:
                secretRef: credential
            configurations:
              groupNameAttribute: cn
              groupObjectClass: group
              groupMemberAttribute: member
              groupMemberAttributePattern: CN=(.*),DC=example,DC=com
              groupSearchBase: dc=example,dc=com
              groupSearchScope: 1
              userNameAttribute: cn
              userMemberOfAttributePattern: CN=(.*),DC=example,DC=com
              userObjectClass: organizationalRole
              userSearchBase: dc=example,dc=com
              usersearchScope: 1
dependencies:
  zookeeper:
    endpoint: zookeeper.confluent.svc.cluster.local:2182
    authentication:
      type: digest
      jaasConfig:
        secretRef: credential
    tls:
      enabled: true
---
apiVersion: platform.confluent.io/v1beta1
kind: Connect
metadata:
  name:  connect
  namespace: confluent
spec:
  replicas: 1
  image:
    application: confleuntinc/cp-server-connect:7.6.0
    init: confluentinc/confluent-init-container:2.8.0
  tls:
    autogeneratedCerts: true
  externalAccess:
    type: loadBalancer
    loadBalancer:
      domain: my.domain
      prefix: rb-connect
    authorization:
      type: rbac
    dependencies:
      kafka:
        bootstrapEndpoint: kafka.confluent.svc.cluster.local:9071
        authentication:
          type: plain
          jaasConfig:
            secretRef: credential
        tls:
          enabled: true