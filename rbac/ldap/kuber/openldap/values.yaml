name: ldap
image: osixia/openldap:1.5.0
tls:
  autogeneratedCerts: true

env:
  LDAP_ORGANIZATION: "example"
  LDAP_DOMAIN: "example.com"
  LDAP_ADMIN_PASSWORD: "secret"
  LDAP_CONFIG_PASSWORD: "configsecret"
  LDAP_READONLY_USER: "true"
  LDAP_READONLY_USER_USERNAME: "admin"
  LDAP_READONLY_USER_PASSWORD: "secret"
  LDAP_BASE_DN: "dc=example,dc=com"

ldifs:
  # for user kafka
  00_kafka.ldif: |-
    dn: cn=kafka,{{ LDAP_BASE_DN }}
    userPassword: kafka-secret
    description: kafka user
    objectClass: simpleSecurityObject
    objectClass: organizationalRole
    cn: kafka

  # for control center
  01_c3.ldif: |-
    dn: cn=c3,{{ LDAP_BASE_DN }}
    userPassword: c3-secret
    description: control center user
    objectClass: simpleSecurityObject
    objectClass: organizationalRole
    cn: c3

  # for producer client
  02_alice.ldif:  |-
    dn: cn=alice,ou=users,{{ LDAP_BASE_DN }}
    objectClass: inetOrgPerson
    objectClass: posixAccount
    objectClass: shadowAccount
    uid: alice
    sn: producer
    givenName: Alice
    cn: Alice Producer
    displayName: Alice Producer
    uidNumber: 10000
    gidNumber: 5000
    userPassword: aliceproducer
    gecos: alice
    loginShell: /bin/bash
    homeDirectory: /home/alice

  # for consumer client
  03_bob.ldif:  |-
    dn: cn=bob,ou=users,{{ LDAP_BASE_DN }}
    objectClass: inetOrgPerson
    objectClass: posixAccount
    objectClass: shadowAccount
    uid: bob
    sn: consumer
    givenName: Bob
    cn: Bob Consumer
    displayName: Bob Consumer
    uidNumber: 10001
    gidNumber: 5000
    userPassword: bobconsumer
    gecos: bob
    loginShell: /bin/bash
    homeDirectory: /home/bob
  
  # for manager client
  04_charlie.ldif:  |-
    dn: cn=charlie,ou=users,{{ LDAP_BASE_DN }}
    objectClass: inetOrgPerson
    objectClass: posixAccount
    objectClass: shadowAccount
    uid: charlie
    sn: manager
    givenName: Charlie
    cn: Charlie Manager
    displayName: Charlie Manager
    uidNumber: 10002
    gidNumber: 5000
    userPassword: charlie
    gecos: charlie
    loginShell: /bin/bash
    homeDirectory: /home/charlie

  # creates a user group that contains all the users
  05_c3-groupou.ldif: |-
    dn: ou=users,{{ LDAP_BASE_DN }}
    objectClass: organizationalUnit
    ou: Users

    dn: ou=groups,{{ LDAP_BASE_DN }}
    objectClass: organizationalUnit
    ou: Groups

  # create producer group
  06_producers.ldif: |-
    dn: cn=producers,ou=groups,{{ LDAP_BASE_DN }}
    objectClass: posixGroup
    cn: Producers
    gidNumber: 5000

  # create consumer group
  07_consumers.ldif: |-
    dn: cn=consumers,ou=groups,{{ LDAP_BASE_DN }}
    objectClass: posixGroup
    cn: Consumers
    gidNumber: 5001

  # create manager group
  08_managers.ldif: |-
    dn: cn=managers,ou=groups,{{ LDAP_BASE_DN }}
    objectClass: posixGroup
    cn: Managers
    gidNumber: 5002

  # add users to groups
  09_add_alice_to_producers.ldif: |-
    dn: cn=producers,ou=groups,{{ LDAP_BASE_DN }}
    changetype: modify
    add: memberuid
    memberuid: cn=alice,ou=users,{{ LDAP_BASE_DN }}

  10_add_bob_to_consumers.ldif: |-
    dn: cn=consumers,ou=groups,{{ LDAP_BASE_DN }}
    changetype: modify
    add: memberuid
    memberuid: cn=bob,ou=users,{{ LDAP_BASE_DN }}

  11_add_charlie_to_managers.ldif: |-
    dn: cn=managers,ou=groups,{{ LDAP_BASE_DN }}
    changetype: modify
    add: memberuid
    memberuid: cn=charlie,ou=users,{{ LDAP_BASE_DN }}
